<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Patient Portal â€“ Multimedia GP Portal</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/patient.css">
</head>

<body>

<!-- Navigation Bar -->
<nav class="navbar">
    <div class="navbar-container">
        <!-- Left: Logo + Brand -->
        <a href="#" class="navbar-brand">
            <span class="patient-badge">PATIENT</span>
            <span class="brand-text">Patient Portal</span>
        </a>

        <!-- Right: Patient Info -->
        <div class="patient-info">
            <div class="patient-details text-end">
                <div class="fw-semibold" id="patientName">Welcome</div>
                <div class="small opacity-75">Medical Evidence Portal</div>
            </div>
            <div class="patient-icon">
                <i class="bi bi-person-fill"></i>
                <div class="notification-badge" id="notificationCount" style="display: none;">0</div>
            </div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="container-fluid">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div>
            <h2 class="page-title">Medical Evidence Portal</h2>
            <p class="greeting-text" id="currentDate">Loading date...</p>
        </div>
        <button class="btn btn-nhs-primary" data-bs-toggle="modal" data-bs-target="#helpModal">
            <i class="bi bi-question-circle me-2"></i>Help & Support
        </button>
    </div>

    <!-- NEW: Patient ID Entry Section -->
    <div class="patient-id-entry glass-card" id="patientIdEntry">
        <h3>Enter Your Patient ID</h3>
        <p class="lead">Access your medical records, messages, and appointments</p>
        
        <div class="patient-id-input-group">
            <input type="text" 
                   id="patientId" 
                   class="patient-id-input" 
                   placeholder="e.g., P004"
                   maxlength="20">
            <button class="patient-id-btn" id="patientIdSubmitBtn">
                <i class="bi bi-arrow-right-circle me-2"></i>Access Portal
            </button>
        </div>
        
        <div class="patient-id-instructions mt-4">
            <p><i class="bi bi-info-circle"></i>Your Patient ID was provided by your healthcare provider</p>
            <p><i class="bi bi-shield-check"></i>Your information is secure and encrypted</p>
        </div>
    </div>

    <!-- Patient Info Bar (Hidden until ID is entered) -->
    <div class="patient-info-bar glass-card" id="patientInfoBar">
        <div>
            <div class="patient-id-display" id="patientIdDisplay">Patient ID: Not entered</div>
            <div class="info-text">Welcome back! You can now access all portal features</div>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-nhs-secondary" id="refreshBtn">
                <i class="bi bi-arrow-clockwise me-2"></i>Refresh
            </button>
            <button class="btn btn-nhs-primary" id="checkMessagesBtn">
                <i class="bi bi-chat-dots me-2"></i>Check Messages
            </button>
            <button class="btn btn-nhs-secondary" id="changePatientBtn">
                <i class="bi bi-person-plus me-2"></i>Change Patient
            </button>
        </div>
    </div>
    
    <!-- Communication Action Bar (Hidden until ID is entered) -->
    <div class="communication-actions" id="communicationActions">
        <button class="action-btn active" id="btnUpload">
            <i class="bi bi-cloud-arrow-up"></i>
            Upload Evidence
        </button>
        <button class="action-btn" id="btnMessages">
            <i class="bi bi-chat-text"></i>
            GP Messages <span class="badge bg-danger ms-1" id="unreadBadge">0</span>
        </button>
        <button class="action-btn" id="btnRecords">
            <i class="bi bi-file-earmark-medical"></i>
            My Records
        </button>
        <button class="action-btn" id="btnAppointments">
            <i class="bi bi-calendar-check"></i>
            Appointments
        </button>
    </div>

    <!-- Main Content Grid -->
    <div class="main-grid">
        <!-- Upload Panel (Default View) -->
        <div class="panel" id="uploadPanel">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="panel-title mb-0">Submit Medical Evidence</h3>
                <span class="badge bg-purple text-white">Secure Upload</span>
            </div>
            
            <p class="info-text mb-4">Upload images, documents, or videos related to your symptoms or condition for your GP to review.</p>

            <form id="uploadForm" class="mt-4">
                <!-- Patient ID field removed from here - it's now at the top -->
                
                <div class="mb-4">
                    <label class="form-label">Select File(s) to Upload</label>
                    <div class="upload-area" id="uploadArea">
                        <input type="file" id="fileInput" class="d-none" accept="image/*,application/pdf,video/*" multiple required>
                        <div class="upload-icon">
                            <i class="bi bi-cloud-arrow-up-fill"></i>
                        </div>
                        <h5>Upload your files</h5>
                        <p class="info-text">Click to browse or drag and drop files here</p>
                        <p class="info-text">Supported formats: JPG, PNG, PDF, MP4, MOV (Max 20MB each)</p>
                        <div id="selectedFileName" class="mt-3 fw-bold text-primary" style="display: none;"></div>
                    </div>
                    <div id="fileThumbnails" class="upload-thumbnails"></div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Add a Note (Optional)</label>
                    <textarea id="uploadNote" class="form-control" rows="3" placeholder="Add any notes about these files for your GP..."></textarea>
                </div>

                <!-- Progress bar -->
                <div class="progress mb-4" style="display:none;">
                    <div class="progress-bar" role="progressbar" style="width:0%"></div>
                </div>

                <button class="upload-btn w-100 py-3">
                    <i class="bi bi-cloud-upload me-2"></i>Upload Evidence
                </button>
            </form>

            <div id="msg" class="mt-3 text-center"></div>
        </div>
        
        <!-- Messages Panel (Hidden by default) -->
        <div class="panel" id="messagesPanel" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="panel-title mb-0">Messages from Your GP</h3>
                <span class="badge bg-success text-white" id="gpNameBadge">GP: Dr. Smith</span>
            </div>
            
            <div class="communication-panel">
                <div class="messages-container" id="messagesContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="bi bi-chat-left-text"></i>
                        </div>
                        <h5>No messages yet</h5>
                        <p class="info-text">Your GP will message you here about your records</p>
                    </div>
                </div>
                
                <div class="message-input-container">
                    <input type="text" id="messageInput" class="message-input" placeholder="Type your message here..." disabled>
                    <button id="sendMessageBtn" class="send-btn" disabled>
                        <i class="bi bi-send me-1"></i>Send
                    </button>
                </div>
            </div>
        </div>

        <!-- Records Panel (Hidden by default) -->
        <div class="panel" id="recordsPanel" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="panel-title mb-0">Your Uploaded Records</h3>
                <span class="badge bg-secondary" id="recordCount">0 records</span>
            </div>
            
            <div id="recordsList" class="mt-3">
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="bi bi-file-earmark-medical"></i>
                    </div>
                    <h5>No records found</h5>
                    <p class="info-text">Enter your Patient ID and upload files to see them here</p>
                </div>
            </div>
        </div>
        
        <!-- Appointments Panel (Hidden by default) -->
        <div class="panel" id="appointmentsPanel" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="panel-title mb-0">Upcoming Appointments</h3>
                <button class="btn btn-nhs-primary btn-sm" id="requestAppointmentBtn">
                    <i class="bi bi-plus-circle me-1"></i>Request Appointment
                </button>
            </div>
            
            <div id="appointmentsList" class="mt-3">
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="bi bi-calendar"></i>
                    </div>
                    <h5>No upcoming appointments</h5>
                    <p class="info-text">Request an appointment with your GP</p>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Help & Support</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <h6><i class="bi bi-upload text-primary me-2"></i>Uploading Files</h6>
                        <p class="small">You can upload multiple files at once. Supported formats include images (JPG, PNG), PDFs, and videos (MP4, MOV). Maximum file size is 20MB per file.</p>
                    </div>
                    <div class="col-md-6 mb-4">
                        <h6><i class="bi bi-chat text-success me-2"></i>GP Communication</h6>
                        <p class="small">Message your GP directly about your uploads. Your GP can review your files and respond with notes or questions.</p>
                    </div>
                    <div class="col-md-6 mb-4">
                        <h6><i class="bi bi-shield-check text-info me-2"></i>Security</h6>
                        <p class="small">All uploads are encrypted and secure. Only your healthcare team has access to your files.</p>
                    </div>
                    <div class="col-md-6 mb-4">
                        <h6><i class="bi bi-headset text-warning me-2"></i>Technical Support</h6>
                        <p class="small">For technical issues, please contact: <strong>support@medicalportal.nhs.uk</strong> or call <strong>0300 123 4567</strong>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Video Preview Modal -->
<div class="modal fade" id="videoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Video Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <video id="videoPlayer" controls style="width: 100%; max-height: 70vh;"></video>
            </div>
        </div>
    </div>
</div>

<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/api.js"></script>
<script src="js/patient.js"></script>

</body>
</html>